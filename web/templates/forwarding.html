{{define "title"}}Forwarding Rules – WebhookHub{{end}}

{{define "content"}}
<h2>Forwarding Rules</h2>

<form method="POST" action="/forwarding/save" class="rule-form">
  <input type="text" name="source" placeholder="Webhook source (e.g., stripe)" required>
  <input type="url"  name="target" placeholder="Target URL (https://...)" required>

  <!-- (Stripe-style) -->
  <input type="password"
         name="verify_secret"
         placeholder="Stripe signing secret (whsec_...) — optional"
         autocomplete="off" data-lpignore="true">
  <input type="text"
         name="verify_header"
         placeholder="Signature header (default: Stripe-Signature)">
  <input type="number"
         name="tolerance"
         placeholder="Time tolerance, seconds (default: 300)"
         min="0" step="1">

  <!-- Sign outgoing -->
  <input type="password"
         name="outgoing_secret"
         placeholder="Sign outgoing with this secret (optional)"
         autocomplete="off" data-lpignore="true">

  <button class="btn-primary" type="submit">Add Rule</button>
</form>

<table>
  <thead>
  <tr>
    <th>Source</th>
    <th>Target URL</th>
    <th>Incoming HMAC</th>
    <th>Outgoing HMAC</th>
    <th>Action</th>
  </tr>
  </thead>
  <tbody>
  {{range .}}
  <tr>
    <td>{{.Source}}</td>
    <td>{{.Target}}</td>
    <td>{{if .HasVerifySecret}}✓ ({{.VerifyHeader}}){{else}}—{{end}}</td>
    <td>{{if .HasOutgoingSign}}✓{{else}}—{{end}}</td>
    <td>
      <div class="action-buttons">
        <button
                class="btn-edit"
                hx-get="/forwarding/edit?source={{.Source}}"
                hx-target="#edit-form"
                hx-swap="innerHTML"
                type="button"
        >Edit</button>

        <form method="POST" action="/forwarding/delete" onsubmit="return confirm('Delete this rule?')">
          <input type="hidden" name="source" value="{{.Source}}">
          <button class="btn-delete" type="submit">Delete</button>
        </form>
      </div>
    </td>
  </tr>
  {{end}}
  </tbody>
</table>

<div id="edit-form" style="margin-top: 2rem;"></div>
{{end}}
